# 🚨 긴급! 카카오 설정 점검 체크리스트

## 현재 상황
- ✅ **웹훅 서버**: 정상 작동 (`https://2da26f20f041.ngrok-free.app`)
- ✅ **테스트 메시지**: 정상 전달
- ❌ **실제 고객 메시지**: 전달되지 않음
- ✅ **카카오 채널 앱**: 고객 메시지 수신됨

## 🔧 즉시 확인해야 할 카카오 설정

### 1. 카카오 i 오픈빌더 (https://i.kakao.com/)

#### A. 봇 상태 확인
1. **"봇 리스트"**에서 "townly" 봇 클릭
2. **봇 상태**가 "활성화"인지 확인
3. **만약 비활성화되어 있다면**: "활성화" 버튼 클릭

#### B. 채널 연결 확인
1. **"채널 연결"** 메뉴 클릭
2. **"Townly" 채널**이 목록에 있는지 확인
3. **연결 상태**가 "정상" 또는 "연결됨"인지 확인
4. **만약 연결되지 않았다면**: "채널 연결" 버튼으로 재연결

#### C. 스킬 설정 확인 (가장 중요!)
1. **"스킬"** 메뉴 클릭
2. **웹훅 스킬**이 등록되어 있는지 확인
3. **스킬 URL**: `https://2da26f20f041.ngrok-free.app/api/kakao/webhook`
4. **스킬 상태**가 "활성화"인지 확인
5. **만약 비활성화되어 있다면**: 활성화 필요

#### D. 시나리오 설정 확인 (핵심!)
1. **"시나리오"** 메뉴 클릭
2. **"기본 폴백 블록"** 설정 확인
3. **모든 사용자 입력**이 스킬로 전달되도록 설정되었는지 확인
4. **"예외 상황 처리"**도 스킬로 설정되었는지 확인

### 2. 카카오톡 채널 관리자센터 (https://center-pf.kakao.com/)

#### A. 채널 설정
1. **"Townly" 채널** 선택
2. **"관리 > 채팅"** 메뉴 클릭
3. **"챗봇 연결"**이 활성화되어 있는지 확인
4. **연결된 챗봇**이 "townly"인지 확인

#### B. 자동응답 설정 (매우 중요!)
1. **"자동응답 설정"** 확인
2. **응답 우선순위**가 다음 중 하나인지 확인:
   - "챗봇 우선"
   - "챗봇 전용"
3. **만약 "관리자 우선"으로 설정되어 있다면**: "챗봇 우선"으로 변경

### 3. 실시간 테스트

#### A. 설정 변경 후 테스트
1. 위 설정들을 모두 확인/수정
2. **ppirong@daum.net**으로 카카오 채널에 테스트 메시지 전송
3. **실시간 모니터링**에서 웹훅 호출 확인:
   ```bash
   # 이미 실행 중인 모니터링 확인
   # 새로운 웹훅이 보이는지 관찰
   ```

#### B. ngrok 로그 확인
1. 브라우저에서 http://localhost:4040 접속
2. **"Inspect"** 탭에서 실시간 요청 확인
3. 고객이 메시지를 보낼 때 POST 요청이 들어오는지 확인

## 🎯 가장 가능성 높은 문제

### 문제 1: 자동응답 우선순위
**증상**: 채널 앱에서는 메시지가 보이지만 챗봇으로 전달되지 않음
**원인**: 자동응답이 "관리자 우선"으로 설정되어 있음
**해결**: "챗봇 우선" 또는 "챗봇 전용"으로 변경

### 문제 2: 폴백 블록 미설정
**증상**: 특정 키워드에만 챗봇이 반응함
**원인**: 시나리오에서 폴백 블록이 스킬로 연결되지 않음
**해결**: 기본 폴백 블록을 스킬로 설정

### 문제 3: 봇 비활성화
**증상**: 아예 챗봇이 동작하지 않음
**원인**: 카카오 i 오픈빌더에서 봇이 비활성화됨
**해결**: 봇 활성화

## 🚀 즉시 실행할 단계

1. **카카오 i 오픈빌더** 접속
2. **봇 활성화** 상태 확인
3. **시나리오 > 폴백 블록** 설정을 스킬로 변경
4. **카카오톡 채널 관리자센터** 접속
5. **자동응답 우선순위**를 "챗봇 우선"으로 변경
6. **테스트 메시지** 전송
7. **웹훅 모니터링**에서 결과 확인

이 단계들을 순서대로 진행하면 문제가 해결될 것입니다!

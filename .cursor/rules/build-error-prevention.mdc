---
alwaysApply: false
---
# description: Next.js 15.5.5 + TypeScript strict í™˜ê²½ í†µí•© ë¹Œë“œ ì˜¤ë¥˜ ì˜ˆë°© ê·œì¹™
# ğŸ—ï¸ MetaTrans ë¹Œë“œ ì˜¤ë¥˜ ì˜ˆë°© í†µí•© ê·œì¹™

## ğŸ¯ ëª©ì 
Next.js 15.5.5 & TypeScript strict í™˜ê²½ì—ì„œ ë¹Œë“œ ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ë°©ì§€í•˜ê¸° ìœ„í•œ í†µí•© ê·œì¹™ì…ë‹ˆë‹¤.  
ë¹„ë™ê¸° API, íƒ€ì… ì˜¤ë¥˜, DB ì‚¬ìš© ì˜¤ë¥˜, React ì»´í¬ë„ŒíŠ¸ ì˜¤ë¥˜ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

---

# 1. Next.js 15.5.5 í˜¸í™˜ì„± ê·œì¹™

## 1.1 ëª¨ë“  Next.js APIëŠ” `await` í•„ìˆ˜
```typescript
const { userId } = await auth();
const headerPayload = await headers();
```

## 1.2 paramsëŠ” Promise íƒ€ì…
```typescript
function Page({ params }: { params: Promise<{ id: string }> }) {}
const { id } = await params;
```

---

# 2. TypeScript íƒ€ì… ì•ˆì „ì„± ê·œì¹™

## 2.1 any ì‚¬ìš© ê¸ˆì§€
```typescript
// âŒ ì•”ì‹œì  any
let items = []
let data: any = fetch()

// âœ… unknown ë˜ëŠ” ëª…ì‹œ íƒ€ì… ì‚¬ìš©
let items: { id: number; name: string }[] = []
let data: unknown = fetch()
```

## 2.2 íƒ€ì… ë‹¨ì–¸(as) ë‚¨ìš© ê¸ˆì§€
```typescript
// âŒ
values(data as any)

// âœ… ëª…ì‹œì  í•„ë“œ ë§¤í•‘
values({
  id: data.id,
  name: data.name,
})
```

## 2.3 unknown ë Œë”ë§ ê¸ˆì§€ â†’ í•­ìƒ ì•ˆì „ ë³€í™˜
```tsx
{String(userTranslation ?? 'ë²ˆì—­ ì—†ìŒ')}
{String(question.questionText ?? 'ì§ˆë¬¸ ì—†ìŒ')}
```

## 2.4 íƒ€ì… ê°€ë“œ ì‚¬ìš©
```typescript
const isString = (v: unknown): v is string => typeof v === 'string';
const isRecord = (v: unknown): v is Record<string, unknown> =>
  typeof v === 'object' && v !== null && !Array.isArray(v);
```

## 2.5 ë°˜í™˜ íƒ€ì… ëª…ì‹œ
```typescript
const render = (): React.ReactNode => { ... };
```

## 2.6 React import í•„ìˆ˜
```typescript
import React, { useState, useEffect, useRef } from 'react';
```

## 2.7 ì•”ì‹œì  íƒ€ì… ì¶”ë¡  ê¸ˆì§€
```typescript
// âŒ
let result = {}

// âœ…
let result: Record<string, unknown> = {}
```

---

# 3. ì¤‘ì•™ íƒ€ì… ì‹œìŠ¤í…œ & DTO ê·œì¹™

## 3.1 ì¤‘ì•™ íƒ€ì… ì‹œìŠ¤í…œ ì‚¬ìš©
ëª¨ë“  DB ê´€ë ¨ íƒ€ì…ì€ `src/types/database.ts`ì—ì„œ import.

```typescript
import type { Test, Professional } from "@/types/database"
```

í•„ìš” ì‹œ í™•ì¥:
```typescript
interface ClientTest extends Omit<Test, "createdAt"> {
  createdAt: string
}
```

## 3.2 DTO ë§¤í¼ í•„ìˆ˜ ì ìš©
```typescript
const dbTest = await getTestById(id)
return <TestPage test={mapTestForClient(dbTest)} />
```

## 3.3 DB í•„ë“œëª… ê·œì¹™ ì¤€ìˆ˜
- DB â†’ snake_case
- Client â†’ camelCase (í•„ìš” ì‹œ ë³€í™˜)

```typescript
// DB
interface Professional { created_at: string }

// Client
interface ClientProfessional { createdAt: string }
```

## 3.4 ëª…ì‹œì  ë°ì´í„° ë³€í™˜
```typescript
// ë‚ ì§œ ë³€í™˜
birthDate: data.birthDate instanceof Date
  ? data.birthDate.toISOString().split("T")[0]
  : data.birthDate
```

## 3.5 null/undefined ì•ˆì „ì„±
```typescript
const percentage = maxScore
  ? (total / maxScore) * 100
  : 0
```

---

# 4. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ê·œì¹™

## 4.1 ìë™ íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©
```typescript
// âŒ createdAt ìˆ˜ë™ ì„¤ì •
.values({ createdAt: new Date() })

// âœ…
.values(data)
```

## 4.2 ëª…ì‹œì  í•„ë“œ ë§¤í•‘
```typescript
.values({
  name: data.name,
  birthDate: toDateString(data.birthDate),
})
```

## 4.3 ë¬¸ìì—´/ìˆ«ì ë³€í™˜ ëª…ì‹œ
```typescript
const newExamCount = Number(testTaker.examCount ?? 0) + 1;
const examCount = Number(taker.examCount || 0)
```

## 4.4 í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ ìˆœì„œ í™•ì¸
```typescript
await getTestById(testId, professional.id); // ì „ë¬¸ê°€
await getPublicTestById(testId);            // ì‘ì‹œì
```

## 4.5 ì˜¬ë°”ë¥¸ ìŠ¤í‚¤ë§ˆ ì°¸ì¡°
```typescript
import { multipleChoiceAnswers } from '@/db/schema';
```

---

# 5. Server Actions + Zod ê·œì¹™

## 5.1 ì‚¬ìš©ì ID null ì²˜ë¦¬
```typescript
const actualUserId = user?.id ?? null;
if (!actualUserId) throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");
```

## 5.2 Zod transform í†µì¼
```typescript
const SettingsSchema = z.object({
  points: z.union([z.string(), z.number()]).transform(v =>
    typeof v === 'string' ? parseInt(v) || 1 : v
  ),
  randomizeAnswers: z.union([z.enum(['yes','no']), z.boolean()]).transform(v =>
    typeof v === 'boolean' ? v : v === 'yes'
  )
});
```

---

# 6. React ì»´í¬ë„ŒíŠ¸ ê·œì¹™

## 6.1 useEffect ì˜ì¡´ì„± ë°°ì—´ ì™„ì„±
```typescript
useEffect(() => {
  ...
}, [currentQuestionIndex, questions, handlePrevious, handleNext]);
```

## 6.2 useCallback ì‚¬ìš©
```typescript
const handlePrevious = useCallback(() => {
  if (!isFirstQuestionVar) setCurrentQuestionIndex(i => i - 1);
}, [isFirstQuestionVar]);
```

## 6.3 ë³€ìˆ˜ëª… ì¤‘ë³µ ê¸ˆì§€
```typescript
const isFirstQuestionVar = ...
```

---

# 7. í™˜ê²½ë³€ìˆ˜ & ë°°í¬ ì•ˆì •ì„±

## 7.1 í™˜ê²½ë³€ìˆ˜ ì²´í¬
```typescript
["DATABASE_URL","NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY","CLERK_SECRET_KEY"]
  .forEach(v => { if (!process.env[v]) throw new Error(`Missing ${v}`); });
```

## 7.2 Node/PNPM ë²„ì „ ê³ ì •
```json
"engines": { "node": ">=18", "pnpm": ">=9" }
```

## 7.3 Git ëŒ€ì†Œë¬¸ì ë¯¼ê° ëª¨ë“œ
```bash
git config core.ignorecase false
```

---

# 8. UI / Image ê·œì¹™
- `<img>` ê¸ˆì§€ â†’ ë°˜ë“œì‹œ `next/image`
- ì™¸ë¶€ ì´ë¯¸ì§€ URLì€ `next.config.js`ì— domain ë“±ë¡
- Server Componentì—ì„œëŠ” `useEffect`/`useState` ë¶ˆê°€

---

# 9. ìì£¼ ë°œìƒ ì˜¤ë¥˜ íŒ¨í„´

| ì˜¤ë¥˜ | ì›ì¸ | í•´ê²° |
|------|------|------|
| Module not found | ê²½ë¡œ/ëŒ€ì†Œë¬¸ì ì˜¤ë¥˜ | import ê²½ë¡œ ì¬í™•ì¸ |
| Cannot read properties of undefined | null ì²´í¬ ë¶€ì¡± | ê¸°ë³¸ê°’ / optional chaining |
| Hydration failed | í´ë¼ì´ì–¸íŠ¸ ë¡œì§ì„ ì„œë²„ì—ì„œ ì‹¤í–‰ | useEffectë¡œ ì´ë™ |

---

# 10. í•„ìˆ˜ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

```typescript
export const toISOString = (d: Date | string) =>
  typeof d === "string" ? d : d.toISOString()

export const toRecord = (v: unknown): Record<string, unknown> =>
  typeof v === "object" && v !== null && !Array.isArray(v) ? v : {}

export const isString = (v: unknown): v is string =>
  typeof v === "string"

export const isRecord = (v: unknown): v is Record<string, unknown> =>
  typeof v === "object" && v !== null && !Array.isArray(v)
```

---

# 11. ë¹Œë“œ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

## Next.js
- [ ] `auth()`/`headers()` â†’ `await`
- [ ] `params` â†’ `Promise<T>`
- [ ] ëª¨ë“  Route Handler â†’ `async`

## TypeScript
- [ ] `any` ì‚¬ìš© ì—¬ë¶€ í™•ì¸
- [ ] ë¶ˆí•„ìš”í•œ `as` ì œê±°
- [ ] ëª¨ë“  ë³€ìˆ˜/ë§¤ê°œë³€ìˆ˜ì— íƒ€ì… ì„ ì–¸
- [ ] `unknown` ë Œë”ë§ ê¸ˆì§€
- [ ] ë°˜í™˜ íƒ€ì… ëª…ì‹œ

## ë°ì´í„°ë² ì´ìŠ¤ & DTO
- [ ] ì¤‘ì•™ íƒ€ì… ì‹œìŠ¤í…œ ì‚¬ìš©
- [ ] DTOë¡œ DBâ†’Client ë³€í™˜ ì²˜ë¦¬
- [ ] DB í•„ë“œëª… ê·œì¹™ ì¤€ìˆ˜
- [ ] í•¨ìˆ˜ ì¸ì ìˆœì„œ/íƒ€ì… ì •í™•
- [ ] ì˜¬ë°”ë¥¸ ìŠ¤í‚¤ë§ˆë§Œ ì°¸ì¡°

## React
- [ ] useEffect ì˜ì¡´ì„± 100%
- [ ] useCallback ì ìš©
- [ ] ë³€ìˆ˜ëª… ì¤‘ë³µ ì—†ìŒ
- [ ] null/undefined ì•ˆì „ ì²˜ë¦¬

## ì¸í„°í˜ì´ìŠ¤
- [ ] í•„ë“œëª… ì •í™•
- [ ] í•„ìˆ˜ ì†ì„± ëˆ„ë½ ì—†ìŒ

---

# ğŸš« ì ˆëŒ€ ê¸ˆì§€ì‚¬í•­

1. **Next.js API(`auth`, `headers`, `params`) ë™ê¸°ì‹ í˜¸ì¶œ**
2. **`any` ë‚¨ìš© / `unknown` ì§ì ‘ ë Œë”ë§**
3. **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìŠ¤í‚¤ë§ˆ í•„ë“œ ì°¸ì¡°**
4. **DB í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ ìˆœì„œ ë¬´ì‹œ**
5. **Server Componentì—ì„œ Hooks ì‚¬ìš©**
6. **`<img>` ì‚¬ìš©**

---

# ğŸ“ í•µì‹¬ ì›ì¹™ (Top 4)

1. **any ê¸ˆì§€ & ëª…ì‹œì  íƒ€ì… ì§€ì •**
2. **DTO ë§¤í¼Â·ì¤‘ì•™ íƒ€ì… ì‹œìŠ¤í…œ í•„ìˆ˜**
3. **DB í•„ë“œëª…/íƒ€ì… ë³€í™˜ ëª…í™•íˆ**
4. **Next.js 15.5.5 ë¹„ë™ê¸° API ì¤€ìˆ˜**

ì´ ë„¤ ê°€ì§€ ì›ì¹™ë§Œ ì§€ì¼œë„ ëŒ€ë¶€ë¶„ì˜ ë¹Œë“œ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.